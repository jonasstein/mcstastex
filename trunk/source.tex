% Emacs settings: -*-mode: latex; TeX-master: "manual.tex"; -*-

\section{Source components}
The main function of the source components is to determine a set of initial
parameters $({\bf r}, {\bf v})$, or equivalent (${\bf r}, v, \Ombold $),
for each neutron. This is done by Monte Carlo choices. 
In the current sources no polarization dependence is implemented, 
whence we let ${\bf s}=(0,0)$.

The sources to be presented in the following all make their Monte Carlo
choices on the basis of simple analytical expressions ({\em e.g.} the
energy distribution). 
More realistic sources would require that (at least) the Monte-Carlo choice
for the initial energy was made on basis of a measured,
tabulated energy spectrum.
This is planned to be implemented in a later version of \MCS .

\subsection{Source\_flat: A circular continuous source with a flat energy spectrum}
\label{sourceaim}
This component {\bf Source\_flat} is 
a simple continous source with a flat energy distribution.
The time-of-flight aspect is not relevant for this component,
so we put $t=0$ for all neutrons.

The initial neutron position is chosen randomly from within a
circle of radius $r_{\rm s}$ in the $z=0$ plane. 
This is a fair approximation
of a cylindrical cold source with the beam going out along
the cylinder axis, like the one at Ris\o .

The initial neutron velocity direction is focused within
a solid angle, defined by a rectangular target of width
$w$, height $h$, parallel to 
the $xy$ plane placed at $(0,0,z_{\rm f})$. 
A small angle approximation is used, assuming that 
$w,h \ll z_{\rm f}$.

The weight multiplier of the created neutron, $\pi_1$, is set to the
solid angle of the focusing opening divided by $4\pi$,
see discussion in \ref{s:focus}

The input parameters of {\bf Source\_flat} are the source radius, $r_{\rm s}$,
the distance to the target, $z_{\rm f}$, 
the dimensions of the target, $w$ and $h$, and
the centre and spread of the energy distribution, $E_0$ and $\Delta E$.


\subsection{Source\_flat\_lambda: A continous source with flat
  wavelength spectrum}

The component {\bf Source\_flat\_lambda} is similar to the Source\_flat
component, except that the spectrum is flat in wavelength, rather
than in energy.

The input parameters for Source\_flat\_lambda are \textit{radius} to set
the source radius in meters; \textit{dist}, \textit{xw}, and \textit{yh}
to set the focusing as for Source\_flat; and \textit{lambda\_0} and
\textit{d\_lambda} to set the range of wavelength emitted (the range
will be from $\textit{lambda\_0} - \textit{d\_lambda}$ to
$\textit{lambda\_0} + \textit{d\_lambda}$).


\subsection{Source\_flux\_lambda: A continuous source with absolute
  flux}
\label{Source_flux_lambda}

The component {\bf Source\_flux\_lambda} is a variation on the
Source\_flat\_lambda component. The only difference is the possibility
to specify the absolute flux of the source. The specified flux is used
to adjust the initial neutron weight so that the intensity in the
detectors is directly comparable to a measurement of one second on a
real source with the same flux. This also makes the simulated detector
intensities independent of the number of neutron histories simulated,
easing the comparison between different simulation runs (though of
course more neutron histories will give better statistics).

The flux~$\Phi$ is the number of neutrons emitted per second from a
one~cm$^2$ area on the source surface, with direction within a a one
steradian solid angle, and with wavelength within a one {\AA}ngstr{\o}m
interval. The total number of neutrons emitted towards a given diaframe
in one second is therefore
$$ N_{\rm total} = \Phi A \Omega \Delta\lambda $$
where $A$ is the source area, $\Omega$ is the solid angle of the
diaframe as seen from the source surface, and $\Delta\lambda$ is the
width of the wavelength interval in which neutrons are emitted (assuming
a uniform wavelength spectrum). If $N_{\rm sim}$ denotes the number of
neutron histories to simulate, the initial neutron weight $p_0$ must be set to
$$ p_0 = \frac{N_{\rm total}}{N_{\rm sim}} = 
    \frac{\Phi}{N_{\rm sim}} A \Omega \Delta\lambda $$

The input parameters for Source\_flux\_lambda are \textit{radius} to set
the source radius in meters; \textit{dist}, \textit{xw}, and \textit{yh}
to set the focusing as for Source\_flat; \textit{lambda\_0} and
\textit{d\_lambda} to set the range of wavelength emitted (the range
will be from $\textit{lambda\_0} - \textit{d\_lambda}$ to
$\textit{lambda\_0} + \textit{d\_lambda}$); and \textit{flux} to set the
source flux in units of ${\rm cm}^{-2} {\rm st}^{-1} \textit{\AA}$.


\subsection{Source\_div: A divergent source}

{\bf Source\_div} is a rectangular source which emits a
beam of a certain divergence around the main exit direction
(the direction of the $z$ axis).
The beam intensity and divergence are uniform over
the whole of the source, and the energy distribution
of the beam is uniform.

This component may be used as a simple model of the
beam profile at the end of a guide or at the sample
position.

The input parameters for Source\_div are the source dimensions
$w$ and $h$ (in m), the divergencies $\delta_h$ and $\delta_v$ (FWHM in degrees), 
and the mean energy $E_0$ and the energy spread $dE$ (both in meV).
The neutron energy range is $(E_0-dE; E_0+dE)$. 


\subsection{Moderator: A time-of-flight source}
The simple time-of-flight source component {\bf Moderator} resembles
the source component {\bf Source\_flat} described in \ref{sourceaim}.
Like {\bf Source\_flat}, {\bf Moderator} is circular and focuses
on a rectangular target. Further, the initial velocity is chosen
with a linear distribution within an interval, defined by the
minimum and maximum energies, $E_0$ and $E_1$,
respectively.

The initial time of the neutron is determined on basis of a 
simple heuristical model for the time dependence of the 
neutron intensity from a time-of-flight source.
For all neutron energies, the flux decay is assumed to be exponential,
\begin{equation}
\Psi(E,t) = \exp(-t/\tau(E)) ,
\end{equation}
where the decay constant is given by
\begin{equation}
\tau(E) = \left\{ 
\begin{array}{cc}
 \tau_0                               & ; E<E_c \\
 \tau_0 / [ 1 + (E-E_c)^2/\gamma^2 ]  & ; E \geq E_c
\end{array}
\right.
\end{equation}

The input parameters for {\bf Moderator} are the source radius, $r_{\rm s}$,
the minimum and maximum energies, $E_0$ and $E_1$ (in meV),
the distance to the target, $z_{\rm f}$, the dimensions of the target,
$w$ and $h$, and the decay parameters 
$\tau_0$ (in $\mu$s), $E_c$, and $\gamma$ (both in meV).


\input{Source_adapt}

\input{Source_Optimizer}
